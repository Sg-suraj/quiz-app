<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizMaster Pro - Interactive Learning Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #6366f1;
            --color-primary-dark: #4f46e5;
            --color-primary-light: #a5b4fc;
            --color-secondary: #f1f5f9;
            --color-accent: #06b6d4;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-warning: #f59e0b;
            --color-text: #1e293b;
            --color-text-light: #64748b;
            --color-text-muted: #94a3b8;
            --color-bg: #ffffff;
            --color-bg-secondary: #f8fafc;
            --color-border: #e2e8f0;
            --color-border-light: #f1f5f9;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-error: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --border-radius: 12px;
            --border-radius-lg: 16px;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --max-width: 900px;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: var(--gradient-primary);
            min-height: 100vh;
            color: var(--color-text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 1rem;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            width: 100%;
            max-width: var(--max-width);
            background: var(--color-bg);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Header Styles */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='7' cy='7' r='3'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            opacity: 0.1;
        }

        .header > * {
            position: relative;
            z-index: 1;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 400;
        }

        /* Loading Screen */
        .loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            padding: 3rem;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--color-border);
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2rem;
            color: var(--color-text-light);
            text-align: center;
        }

        /* Progress Bar */
        .progress-section {
            padding: 1.5rem 2rem;
            background: var(--color-bg-secondary);
            border-bottom: 1px solid var(--color-border);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .question-counter {
            font-weight: 600;
            color: var(--color-text);
            font-size: 1rem;
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .score-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .score-correct { color: var(--color-success); }
        .score-incorrect { color: var(--color-error); }

        .progress-bar {
            height: 8px;
            background: var(--color-border-light);
            border-radius: 100px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 100px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Quiz Content */
        .quiz-content {
            padding: 3rem 2rem;
        }

        .question-card {
            margin-bottom: 2rem;
            animation: slideInUp 0.5s ease-out;
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .question-number {
            background: var(--gradient-primary);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            box-shadow: var(--shadow-md);
            flex-shrink: 0;
        }

        .question-meta {
            flex-grow: 1;
        }

        .difficulty-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .difficulty-easy { 
            background: rgba(16, 185, 129, 0.1); 
            color: var(--color-success); 
        }
        .difficulty-medium { 
            background: rgba(245, 158, 11, 0.1); 
            color: var(--color-warning); 
        }
        .difficulty-hard { 
            background: rgba(239, 68, 68, 0.1); 
            color: var(--color-error); 
        }

        .category-tag {
            background: rgba(99, 102, 241, 0.1);
            color: var(--color-primary);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--color-text);
            line-height: 1.4;
            margin-bottom: 2.5rem;
        }

        /* Timer */
        .timer-section {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .timer {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            background: var(--color-bg-secondary);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 1rem;
            transition: var(--transition);
        }

        .timer.warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--color-warning);
            color: var(--color-warning);
            animation: pulse 1s infinite;
        }

        .timer.critical {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--color-error);
            color: var(--color-error);
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Options */
        .options-grid {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option-button {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem 1.5rem;
            background: var(--color-bg);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            font-size: 1rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .option-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.3s ease;
            z-index: 0;
        }

        .option-button > * {
            position: relative;
            z-index: 1;
        }

        .option-letter {
            width: 36px;
            height: 36px;
            background: var(--color-bg-secondary);
            color: var(--color-text);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
            transition: var(--transition);
        }

        .option-text {
            flex-grow: 1;
            line-height: 1.5;
        }

        .option-button:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .option-button:hover::before {
            width: 100%;
        }

        .option-button:hover {
            color: white;
        }

        .option-button:hover .option-letter {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .option-button.selected {
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .option-button.selected .option-letter {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .option-button.correct {
            border-color: var(--color-success);
            background: var(--color-success);
            color: white;
            animation: correctAnswer 0.6s ease;
        }

        .option-button.correct .option-letter {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .option-button.incorrect {
            border-color: var(--color-error);
            background: var(--color-error);
            color: white;
            animation: incorrectAnswer 0.6s ease;
        }

        .option-button.incorrect .option-letter {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        @keyframes correctAnswer {
            0%, 100% { transform: translateY(-2px) scale(1); }
            50% { transform: translateY(-2px) scale(1.02); }
        }

        @keyframes incorrectAnswer {
            0%, 100% { transform: translateY(-2px) translateX(0); }
            25% { transform: translateY(-2px) translateX(-4px); }
            75% { transform: translateY(-2px) translateX(4px); }
        }

        /* Navigation */
        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .nav-button {
            padding: 1rem 2rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 120px;
            justify-content: center;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary {
            background: var(--color-bg-secondary);
            color: var(--color-text);
            border: 2px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: var(--color-border);
            transform: translateY(-1px);
        }

        /* Results Page */
        .results-container {
            padding: 3rem 2rem;
            text-align: center;
            animation: slideInUp 0.6s ease-out;
        }

        .results-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: var(--shadow-lg);
        }

        .results-icon.excellent {
            background: var(--gradient-success);
        }

        .results-icon.good {
            background: linear-gradient(135deg, var(--color-warning), #d97706);
        }

        .results-icon.needs-improvement {
            background: var(--gradient-error);
        }

        .results-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            color: var(--color-text);
        }

        .results-score {
            font-size: 4rem;
            font-weight: 900;
            margin-bottom: 2rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
        }

        .stat-card {
            background: var(--color-bg-secondary);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--color-text-light);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .stat-correct .stat-value { color: var(--color-success); }
        .stat-incorrect .stat-value { color: var(--color-error); }
        .stat-time .stat-value { color: var(--color-primary); }
        .stat-accuracy .stat-value { color: var(--color-accent); }

        /* Review Section */
        .results-review {
            margin-top: 3rem;
            text-align: left;
        }

        .review-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
            text-align: center;
            color: var(--color-text);
        }

        .review-item {
            background: var(--color-bg-secondary);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid transparent;
        }

        .review-item.correct {
            border-left-color: var(--color-success);
            background: rgba(16, 185, 129, 0.05);
        }

        .review-item.incorrect {
            border-left-color: var(--color-error);
            background: rgba(239, 68, 68, 0.05);
        }

        .review-question {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--color-text);
        }

        .review-answer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .answer-label {
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .answer-correct { color: var(--color-success); }
        .answer-incorrect { color: var(--color-error); }

        /* Error State */
        .error-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            padding: 3rem;
            text-align: center;
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        .error-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--color-text);
        }

        .error-message {
            color: var(--color-text-light);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: var(--gradient-success);
        }

        .toast.error {
            background: var(--gradient-error);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app {
                padding: 1rem;
            }

            .header {
                padding: 1.5rem;
            }

            .logo {
                font-size: 2rem;
            }

            .quiz-content {
                padding: 2rem 1.5rem;
            }

            .question-text {
                font-size: 1.3rem;
            }

            .quiz-navigation {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-button {
                width: 100%;
            }

            .results-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .stat-card {
                padding: 1.5rem;
            }

            .results-score {
                font-size: 3rem;
            }

            .progress-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .score-display {
                gap: 1rem;
            }
        }

        @media (max-width: 480px) {
            .results-stats {
                grid-template-columns: 1fr;
            }

            .question-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .question-number {
                align-self: flex-start;
            }
        }

        /* Focus States for Accessibility */
        .option-button:focus,
        .nav-button:focus {
            outline: 3px solid var(--color-primary-light);
            outline-offset: 2px;
        }

        /* Print Styles */
        @media print {
            .timer-section,
            .quiz-navigation {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // API Configuration
        const API_BASE_URL = 'https://opentdb.com/api.php';
        const QUESTION_AMOUNT = 10;
        const QUESTION_TIME = 30; // seconds

        // Utility Functions
        const decodeHtmlEntities = (text) => {
            const textArea = document.createElement('textarea');
            textArea.innerHTML = text;
            return textArea.value;
        };

        const shuffleArray = (array) => {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        };

        const formatTime = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        };

        // Custom Hooks
        const useTimer = (initialTime, onTimeUp, isActive) => {
            const [timeLeft, setTimeLeft] = useState(initialTime);

            useEffect(() => {
                setTimeLeft(initialTime);
            }, [initialTime]);

            useEffect(() => {
                if (!isActive || timeLeft <= 0) return;

                const timer = setInterval(() => {
                    setTimeLeft(prev => {
                        if (prev <= 1) {
                            onTimeUp();
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);

                return () => clearInterval(timer);
            }, [timeLeft, onTimeUp, isActive]);

            return timeLeft;
        };

        const useQuestions = () => {
            const [questions, setQuestions] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            const fetchQuestions = useCallback(async (difficulty = 'mixed') => {
                setLoading(true);
                setError(null);

                try {
                    // Build API URL
                    let apiUrl = `${API_BASE_URL}?amount=${QUESTION_AMOUNT}&type=multiple`;
                    
                    if (difficulty !== 'mixed') {
                        apiUrl += `&difficulty=${difficulty}`;
                    }

                    const response = await fetch(apiUrl);
                    
                    if (!response.ok) {
                        throw new Error('Failed to fetch questions');
                    }

                    const data = await response.json();

                    if (data.response_code !== 0) {
                        throw new Error('No questions available for this configuration');
                    }

                    // Transform API data to our format
                    const transformedQuestions = data.results.map((q, index) => {
                        const options = shuffleArray([
                            ...q.incorrect_answers.map(decodeHtmlEntities),
                            decodeHtmlEntities(q.correct_answer)
                        ]);

                        return {
                            id: index + 1,
                            question: decodeHtmlEntities(q.question),
                            options: options,
                            correctAnswer: options.indexOf(decodeHtmlEntities(q.correct_answer)),
                            category: decodeHtmlEntities(q.category),
                            difficulty: q.difficulty,
                            type: q.type
                        };
                    });

                    setQuestions(transformedQuestions);
                } catch (err) {
                    setError(err.message);
                    // Fallback to sample questions if API fails
                    const fallbackQuestions = [
                        {
                            id: 1,
                            question: "What is the capital of France?",
                            options: ["London", "Berlin", "Paris", "Madrid"],
                            correctAnswer: 2,
                            category: "Geography",
                            difficulty: "easy"
                        },
                        {
                            id: 2,
                            question: "Which programming language is known as the 'language of the web'?",
                            options: ["Python", "Java", "JavaScript", "C++"],
                            correctAnswer: 2,
                            category: "Technology",
                            difficulty: "medium"
                        },
                        {
                            id: 3,
                            question: "What is the largest planet in our solar system?",
                            options: ["Earth", "Jupiter", "Saturn", "Mars"],
                            correctAnswer: 1,
                            category: "Science",
                            difficulty: "easy"
                        },
                        {
                            id: 4,
                            question: "In which year did World War II end?",
                            options: ["1944", "1945", "1946", "1947"],
                            correctAnswer: 1,
                            category: "History",
                            difficulty: "medium"
                        },
                        {
                            id: 5,
                            question: "What is the chemical symbol for gold?",
                            options: ["Go", "Gd", "Au", "Ag"],
                            correctAnswer: 2,
                            category: "Science",
                            difficulty: "hard"
                        }
                    ];
                    setQuestions(fallbackQuestions);
                } finally {
                    setLoading(false);
                }
            }, []);

            return { questions, loading, error, fetchQuestions };
        };

        // Components
        const Toast = ({ message, type, show, onClose }) => {
            useEffect(() => {
                if (show) {
                    const timer = setTimeout(onClose, 3000);
                    return () => clearTimeout(timer);
                }
            }, [show, onClose]);

            return (
                <div className={`toast ${type} ${show ? 'show' : ''}`}>
                    {type === 'success' ? '✓' : '✗'} {message}
                </div>
            );
        };

        const LoadingScreen = () => (
            <div className="loading-screen">
                <div className="loading-spinner"></div>
                <div className="loading-text">
                    Loading quiz questions...<br />
                    <small>Fetching from Open Trivia Database</small>
                </div>
            </div>
        );

        const ErrorScreen = ({ error, onRetry }) => (
            <div className="error-screen">
                <div className="error-icon">🚫</div>
                <h2 className="error-title">Oops! Something went wrong</h2>
                <p className="error-message">
                    {error || 'Unable to load quiz questions. Please check your internet connection and try again.'}
                </p>
                <button className="nav-button btn-primary" onClick={onRetry}>
                    Try Again
                </button>
            </div>
        );

        const ProgressBar = ({ current, total, score }) => {
            const progress = (current / total) * 100;
            const correctAnswers = score;
            const incorrectAnswers = current - 1 - score;

            return (
                <div className="progress-section">
                    <div className="progress-info">
                        <span className="question-counter">
                            Question {current} of {total}
                        </span>
                        <div className="score-display">
                            <div className="score-item score-correct">
                                ✓ {correctAnswers}
                            </div>
                            <div className="score-item score-incorrect">
                                ✗ {incorrectAnswers}
                            </div>
                        </div>
                    </div>
                    <div className="progress-bar">
                        <div 
                            className="progress-fill" 
                            style={{ width: `${progress}%` }}
                        ></div>
                    </div>
                </div>
            );
        };

        const Timer = ({ timeLeft, isActive }) => {
            const getTimerClass = () => {
                if (timeLeft <= 5) return 'timer critical';
                if (timeLeft <= 10) return 'timer warning';
                return 'timer';
            };

            return (
                <div className="timer-section">
                    <div className={getTimerClass()}>
                        ⏱️ {formatTime(timeLeft)}
                    </div>
                </div>
            );
        };

        const QuestionCard = ({ 
            question, 
            questionNumber, 
            selectedOption, 
            onOptionSelect, 
            showAnswer,
            totalQuestions 
        }) => {
            const optionLabels = ['A', 'B', 'C', 'D'];

            const getOptionClass = (index) => {
                if (!showAnswer) {
                    return selectedOption === index ? 'selected' : '';
                }

                if (index === question.correctAnswer) {
                    return 'correct';
                }

                if (selectedOption === index && index !== question.correctAnswer) {
                    return 'incorrect';
                }

                return '';
            };

            return (
                <div className="question-card">
                    <div className="question-header">
                        <div className="question-number">{questionNumber}</div>
                        <div className="question-meta">
                            <div className={`difficulty-badge difficulty-${question.difficulty}`}>
                                {question.difficulty}
                            </div>
                            <div className="category-tag">{question.category}</div>
                        </div>
                    </div>

                    <h2 className="question-text">{question.question}</h2>

                    <div className="options-grid">
                        {question.options.map((option, index) => (
                            <button
                                key={index}
                                className={`option-button ${getOptionClass(index)}`}
                                onClick={() => !showAnswer && onOptionSelect(index)}
                                disabled={showAnswer}
                                aria-label={`Option ${optionLabels[index]}: ${option}`}
                            >
                                <div className="option-letter">{optionLabels[index]}</div>
                                <div className="option-text">{option}</div>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const ResultsScreen = ({ 
            score, 
            totalQuestions, 
            timeTaken, 
            answers, 
            questions, 
            onRestart 
        }) => {
            const percentage = Math.round((score / totalQuestions) * 100);
            
            const getResultInfo = () => {
                if (percentage >= 80) {
                    return { 
                        title: "Outstanding!", 
                        icon: "🏆", 
                        class: "excellent",
                        message: "You're a quiz champion!"
                    };
                } else if (percentage >= 60) {
                    return { 
                        title: "Well Done!", 
                        icon: "👍", 
                        class: "good",
                        message: "Good knowledge, keep it up!"
                    };
                } else {
                    return { 
                        title: "Keep Learning!", 
                        icon: "📚", 
                        class: "needs-improvement",
                        message: "Practice makes perfect!"
                    };
                }
            };

            const resultInfo = getResultInfo();
            const accuracy = percentage;
            const averageTime = Math.round(timeTaken / totalQuestions);

            return (
                <div className="results-container">
                    <div className={`results-icon ${resultInfo.class}`}>
                        {resultInfo.icon}
                    </div>
                    
                    <h2 className="results-title">{resultInfo.title}</h2>
                    <div className="results-score">{percentage}%</div>
                    <p style={{ marginBottom: '2rem', color: 'var(--color-text-light)', fontSize: '1.1rem' }}>
                        {resultInfo.message}
                    </p>
                    
                    <div className="results-stats">
                        <div className="stat-card stat-correct">
                            <div className="stat-value">{score}</div>
                            <div className="stat-label">Correct Answers</div>
                        </div>
                        <div className="stat-card stat-incorrect">
                            <div className="stat-value">{totalQuestions - score}</div>
                            <div className="stat-label">Incorrect Answers</div>
                        </div>
                        <div className="stat-card stat-accuracy">
                            <div className="stat-value">{accuracy}%</div>
                            <div className="stat-label">Accuracy Rate</div>
                        </div>
                        <div className="stat-card stat-time">
                            <div className="stat-value">{formatTime(timeTaken)}</div>
                            <div className="stat-label">Total Time</div>
                        </div>
                    </div>

                    {/* Answer Review */}
                    <div className="results-review">
                        <h3 className="review-title">📋 Answer Review</h3>
                        {questions.map((question, index) => {
                            const userAnswer = answers[index];
                            const isCorrect = userAnswer === question.correctAnswer;
                            
                            return (
                                <div key={index} className={`review-item ${isCorrect ? 'correct' : 'incorrect'}`}>
                                    <div className="review-question">
                                        <strong>Q{index + 1}:</strong> {question.question}
                                    </div>
                                    <div className="review-answer">
                                        <div>
                                            <span className="answer-label">Your answer:</span>
                                            <span className={isCorrect ? 'answer-correct' : 'answer-incorrect'}>
                                                {userAnswer !== null ? question.options[userAnswer] : 'No answer'}
                                            </span>
                                        </div>
                                        {!isCorrect && (
                                            <div>
                                                <span className="answer-label">Correct:</span>
                                                <span className="answer-correct">
                                                    {question.options[question.correctAnswer]}
                                                </span>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    <button className="nav-button btn-primary" onClick={onRestart}>
                        🔄 Take Another Quiz
                    </button>
                </div>
            );
        };

        // Main Quiz Application
        const QuizApp = () => {
            const { questions, loading, error, fetchQuestions } = useQuestions();
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [selectedOption, setSelectedOption] = useState(null);
            const [answers, setAnswers] = useState([]);
            const [score, setScore] = useState(0);
            const [showAnswer, setShowAnswer] = useState(false);
            const [quizCompleted, setQuizCompleted] = useState(false);
            const [quizStartTime, setQuizStartTime] = useState(null);
            const [totalTimeTaken, setTotalTimeTaken] = useState(0);
            const [toast, setToast] = useState({ show: false, message: '', type: '' });
            const [difficulty, setDifficulty] = useState('mixed');

            // Timer for current question
            const timeLeft = useTimer(
                QUESTION_TIME,
                () => handleTimeUp(),
                !showAnswer && !quizCompleted && quizStartTime !== null
            );

            const showToast = (message, type) => {
                setToast({ show: true, message, type });
            };

            const hideToast = () => {
                setToast({ show: false, message: '', type: '' });
            };

            // Initialize quiz
            useEffect(() => {
                fetchQuestions(difficulty);
            }, [fetchQuestions, difficulty]);

            // Start timer when quiz begins
            useEffect(() => {
                if (questions.length > 0 && !quizStartTime) {
                    setQuizStartTime(Date.now());
                }
            }, [questions, quizStartTime]);

            const handleOptionSelect = (optionIndex) => {
                if (showAnswer) return;
                setSelectedOption(optionIndex);
            };

            const handleTimeUp = () => {
                if (selectedOption === null) {
                    showToast("Time's up! Moving to next question.", 'error');
                    handleNext();
                } else {
                    handleNext();
                }
            };

            const handleNext = () => {
                if (selectedOption === null && !showAnswer) {
                    showToast("Please select an answer before continuing.", 'error');
                    return;
                }

                const currentQuestion = questions[currentQuestionIndex];
                const isCorrect = selectedOption === currentQuestion.correctAnswer;

                // Update answers array
                const newAnswers = [...answers];
                newAnswers[currentQuestionIndex] = selectedOption;
                setAnswers(newAnswers);

                // Update score
                if (isCorrect && !showAnswer) {
                    setScore(score + 1);
                    showToast("Correct! Well done! 🎉", 'success');
                } else if (!showAnswer) {
                    showToast(`Incorrect. The answer was: ${currentQuestion.options[currentQuestion.correctAnswer]}`, 'error');
                }

                setShowAnswer(true);

                // Move to next question after delay
                setTimeout(() => {
                    if (currentQuestionIndex + 1 < questions.length) {
                        setCurrentQuestionIndex(currentQuestionIndex + 1);
                        setSelectedOption(null);
                        setShowAnswer(false);
                    } else {
                        // Quiz completed
                        setQuizCompleted(true);
                        setTotalTimeTaken(Math.floor((Date.now() - quizStartTime) / 1000));
                        
                        // Save score to localStorage (high scores feature)
                        const savedScores = JSON.parse(localStorage.getItem('quizHighScores') || '[]');
                        const newScore = {
                            score,
                            total: questions.length,
                            percentage: Math.round((score / questions.length) * 100),
                            date: new Date().toISOString(),
                            timeTaken: Math.floor((Date.now() - quizStartTime) / 1000)
                        };
                        savedScores.push(newScore);
                        savedScores.sort((a, b) => b.percentage - a.percentage);
                        localStorage.setItem('quizHighScores', JSON.stringify(savedScores.slice(0, 10))); // Keep top 10
                    }
                }, 2000);
            };

            const handlePrevious = () => {
                if (currentQuestionIndex > 0) {
                    setCurrentQuestionIndex(currentQuestionIndex - 1);
                    setSelectedOption(answers[currentQuestionIndex - 1] || null);
                    setShowAnswer(false);
                }
            };

            const handleRestart = () => {
                setCurrentQuestionIndex(0);
                setSelectedOption(null);
                setAnswers([]);
                setScore(0);
                setShowAnswer(false);
                setQuizCompleted(false);
                setQuizStartTime(null);
                setTotalTimeTaken(0);
                fetchQuestions(difficulty);
            };

            const handleRetry = () => {
                fetchQuestions(difficulty);
            };

            // Keyboard navigation
            useEffect(() => {
                const handleKeyPress = (e) => {
                    if (quizCompleted || showAnswer) return;

                    const key = e.key.toLowerCase();
                    if (['a', 'b', 'c', 'd'].includes(key)) {
                        const optionIndex = key.charCodeAt(0) - 97; // Convert 'a' to 0, 'b' to 1, etc.
                        if (optionIndex < questions[currentQuestionIndex]?.options.length) {
                            handleOptionSelect(optionIndex);
                        }
                    } else if (key === 'enter' || key === ' ') {
                        e.preventDefault();
                        handleNext();
                    }
                };

                window.addEventListener('keydown', handleKeyPress);
                return () => window.removeEventListener('keydown', handleKeyPress);
            }, [currentQuestionIndex, selectedOption, showAnswer, quizCompleted, questions]);

            if (loading) {
                return (
                    <div className="app">
                        <div className="container">
                            <header className="header">
                                <h1 className="logo">QuizMaster Pro</h1>
                                <p className="tagline">Interactive Learning Platform</p>
                            </header>
                            <LoadingScreen />
                        </div>
                    </div>
                );
            }

            if (error && questions.length === 0) {
                return (
                    <div className="app">
                        <div className="container">
                            <header className="header">
                                <h1 className="logo">QuizMaster Pro</h1>
                                <p className="tagline">Interactive Learning Platform</p>
                            </header>
                            <ErrorScreen error={error} onRetry={handleRetry} />
                        </div>
                    </div>
                );
            }

            if (quizCompleted) {
                return (
                    <div className="app">
                        <div className="container">
                            <header className="header">
                                <h1 className="logo">QuizMaster Pro</h1>
                                <p className="tagline">Quiz Complete! 🎉</p>
                            </header>
                            <ResultsScreen
                                score={score}
                                totalQuestions={questions.length}
                                timeTaken={totalTimeTaken}
                                answers={answers}
                                questions={questions}
                                onRestart={handleRestart}
                            />
                        </div>
                        <Toast
                            message={toast.message}
                            type={toast.type}
                            show={toast.show}
                            onClose={hideToast}
                        />
                    </div>
                );
            }

            const currentQuestion = questions[currentQuestionIndex];

            return (
                <div className="app">
                    <div className="container">
                        <header className="header">
                            <h1 className="logo">QuizMaster Pro</h1>
                            <p className="tagline">Test your knowledge • Learn something new</p>
                        </header>

                        <ProgressBar 
                            current={currentQuestionIndex + 1} 
                            total={questions.length}
                            score={score}
                        />

                        <div className="quiz-content">
                            <Timer timeLeft={timeLeft} isActive={!showAnswer} />

                            <QuestionCard
                                question={currentQuestion}
                                questionNumber={currentQuestionIndex + 1}
                                selectedOption={selectedOption}
                                onOptionSelect={handleOptionSelect}
                                showAnswer={showAnswer}
                                totalQuestions={questions.length}
                            />

                            <div className="quiz-navigation">
                                <button
                                    className="nav-button btn-secondary"
                                    onClick={handlePrevious}
                                    disabled={currentQuestionIndex === 0}
                                >
                                    ← Previous
                                </button>
                                
                                <button
                                    className="nav-button btn-primary"
                                    onClick={handleNext}
                                    disabled={selectedOption === null && !showAnswer}
                                >
                                    {currentQuestionIndex + 1 === questions.length 
                                        ? 'Finish Quiz' 
                                        : 'Next Question'} →
                                </button>
                            </div>

                            <div style={{ 
                                textAlign: 'center', 
                                marginTop: '2rem', 
                                color: 'var(--color-text-light)', 
                                fontSize: '0.9rem' 
                            }}>
                                💡 Use keyboard shortcuts: A, B, C, D to select • Enter to continue
                            </div>
                        </div>
                    </div>

                    <Toast
                        message={toast.message}
                        type={toast.type}
                        show={toast.show}
                        onClose={hideToast}
                    />
                </div>
            );
        };

        // Render the application
        ReactDOM.render(<QuizApp />, document.getElementById('root'));
    </script>

    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>